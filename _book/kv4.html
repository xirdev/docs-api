
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>KV4 Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="rpi_and_devices.html" />
    
    
    <link rel="prev" href="http_api.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="vsl.html">
            
                <a href="vsl.html">
            
                    
                    The VSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="http_api.html">
            
                <a href="http_api.html">
            
                    
                    HTTP Api
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="kv4.html">
            
                <a href="kv4.html">
            
                    
                    KV4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="rpi_and_devices.html">
            
                <a href="rpi_and_devices.html">
            
                    
                    Devices and Neurons
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >KV4</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="kv4">KV4</h1>
<p>KV4 and it&apos;s understanding is essential to understand the system. Why 4D?</p>
<h3 id="dimensional-progression">Dimensional Progression</h3>
<table>
<thead>
<tr>
<th>Dimension</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1D</td>
<td>Not much to say about this a hash table is a 1D k/v store</td>
</tr>
<tr>
<td>2D</td>
<td>Index a hash table by path. Each path has a hash at each segment junction.</td>
</tr>
<tr>
<td>3D</td>
<td>Index a hash table by path / layer. Each segment/layer has a has a hash</td>
</tr>
<tr>
<td>4D</td>
<td>An 3D hash hash where each K/V is a time series, that is, nothing is deleted.</td>
</tr>
</tbody>
</table>
<p>e.g. KV4 essentially boils down to ...</p>
<pre><code>KV4.put(&quot;/accounts/&quot;,&quot;ritchie&quot;,{&quot;last_name&quot;: &quot;turner&quot;},&quot;default&quot;) 
KV4.get(&quot;/accounts&quot;,&quot;ritchie&quot;,&quot;default&quot;) =&gt; {&quot;last_name&quot;: &quot;turner&quot;}

KV4.get_timeseries(&quot;/accounts&quot;,&quot;ritchie&quot;,&quot;default&quot;) =&gt; [{time_stamp,who,{&quot;last_name&quot;: &quot;turner&quot;}]
</code></pre><h2 id="scaling">Scaling</h2>
<p>KV4 is based upon CouchDB, and takes advantage of a fairly unique property of CouchDB, it&apos;s changes feed.</p>
<p>VSL&apos;s provide an up to date distributed view of any KV4 data from a &quot;centralized&quot; CouchDB. Centralized is in double quotes as CouchDB data may be replicated between data centers, so each regional cluster maintains a local CouchDB, which all local VSLs may talk to, but these CouchDBs are then replicated between data centers. This property of CouchDB is very well documented, and highly reliable.</p>
<p>Thus, a Xirsys platform cluster, consists of multiple VSL each of which maintains a dynamic cache of up to date KV4 key/values. The VSL manages it&apos;s cache consistency via the CouchDB changes feed.</p>
<p>After the first hit on the db (couchdb) a k/v is in the VSL cache. An Erlang supervisor managed connection to the change feed on the source of the data is created. This is a real-time feed, which is consumed by all VSL. Thus if any change is made to the db all caches, in all VSL are updated with great reliability. Because the entire system is based on this mechanism, we have scaleable and fast access from all nodes. Indeed, all VSL&apos;s are equal.</p>
<p>Keys are not loaded on a node if not requested on that node. However if a given key is requested it&apos;s guaranteed to be up to date automatically, without any polling by the client. You can thus within tight loops refer to DB keys knowing that you&apos;ll have the latest value even if it came from a different cluster. That is, new values are pushed transparently to nodes and cached without any intervention.</p>
<p>This single idea powers most of Xirsys functionality, and note that it is not tied to any given service, just to the data model.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="http_api.html" class="navigation navigation-prev " aria-label="Previous page: HTTP Api">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="rpi_and_devices.html" class="navigation navigation-next " aria-label="Next page: Devices and Neurons">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"KV4","level":"1.4","depth":1,"next":{"title":"Devices and Neurons","level":"1.5","depth":1,"path":"rpi_and_devices.md","ref":"rpi_and_devices.md","articles":[]},"previous":{"title":"HTTP Api","level":"1.3","depth":1,"path":"http_api.md","ref":"http_api.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"kv4.md","mtime":"2016-06-07T13:26:07.314Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2016-11-13T14:27:15.892Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

